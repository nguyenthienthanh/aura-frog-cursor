---
description: Load environment variables from .envrc at session start. ALWAYS check env FIRST before responding to any prompt.
globs: []
alwaysApply: true
---

# Rule: Environment Loading

**Version:** 1.11.0
**Priority:** Critical
**Applies:** Session start, before any workflow or prompt response

---

## Rule

**ALWAYS check environment variables FIRST before responding to any prompt.**

If environment is not configured â†’ Run `project:reload-env` automatically.
If learning is enabled â†’ Load memory from cache.

---

## Mandatory Check (Every Session)

Before responding to the user's first message, you MUST:

1. **Check if key env vars are set:**
   ```bash
   # Check critical variables
   [ -n "$SUPABASE_URL" ] && [ -n "$FIGMA_API_KEY" ] || echo "ENV NOT LOADED"
   ```

2. **If NOT configured â†’ Auto-run reload:**
   ```bash
   # Locate and source .envrc
   if [ -f ".envrc" ]; then
     source .envrc
   elif [ -f ".cursor/.envrc" ]; then
     source .cursor/.envrc
   fi
   ```

3. **Load memory cache (if learning enabled):**
   ```bash
   # Check for memory cache
   if [ -f ".cursor/cache/memory-context.md" ]; then
     # Read cached learned patterns
     cat .cursor/cache/memory-context.md
   fi
   ```

4. **Show env status in first response:**
   ```
   ðŸ”Œ MCP: context7 âœ“ | figma âœ“ | playwright âœ“ | vitest âœ“ | slack âœ—
   ðŸ§  Learning: enabled âœ“ | Memory: 15 items loaded
   ```

**NEVER skip this check. NEVER respond without loading env first.**

---

## Steps

1. **Check for `.envrc`** in these locations (in order):
   - `.envrc` (project root)
   - `.cursor/.envrc` (Cursor config directory)
2. **If found, parse** all `export VAR=value` statements
3. **Load variables** into current session context
4. **Verify** critical variables are set before proceeding

**Note:** If both files exist, project root takes priority. Variables from `.cursor/.envrc` are loaded first, then overridden by `.envrc` if present.

---

## Variable Categories

### MCP Integration Credentials
```bash
GITHUB_TOKEN
FIGMA_API_KEY
SLACK_TOKEN, SLACK_TEAM_ID
# Atlassian: No env vars needed (OAuth via browser)
# Or for scripts: JIRA_URL, JIRA_EMAIL, JIRA_API_TOKEN
```

### Learning System (Supabase)
```bash
SUPABASE_URL
SUPABASE_SECRET_KEY
AF_LEARNING_ENABLED
```

### Workflow Settings
```bash
AURA_FROG_AUTO_APPROVE
AURA_FROG_DEFAULT_COVERAGE
AURA_FROG_TDD_ENFORCE
AURA_FROG_AUTO_NOTIFY
AURA_FROG_TOKEN_WARNING
```

---

## Priority Order

```
Environment Variable > Project Config > Global Config > Default
```

---

## Commands

- `project:reload-env` - Reload after editing .envrc
- `project:init` - Creates .envrc template
- `learn:status` - Check learning system status
- `learn:memory` - Load/refresh memory cache

---

**Version:** 1.11.0
**Last Updated:** 2026-02-13
