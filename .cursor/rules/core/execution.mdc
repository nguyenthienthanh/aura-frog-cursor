---
description: Execution rules - behavioral constraints for all Aura Frog operations
globs: []
alwaysApply: true
---

# Execution Rules

**Version:** 2.0.0
**Priority:** CRITICAL - Behavioral constraints for all operations
**Type:** Rule (Behavioral Constraints)
**Updated:** Aligned with 2-gate workflow

---

## Core Rule

These are the fundamental ALWAYS/NEVER rules that govern Aura Frog behavior across all operations.

---

## ALWAYS Do

### Before Any Task

```toon
always_before[3]{num,rule,why}:
 1,Show agent banner,User must know which agent is active
 2,Load project context,Must follow project conventions from .cursor/project-contexts/
 3,Detect appropriate agent,Right specialist for the task
```

### During Workflow

```toon
always_during[6]{num,rule,why}:
 4,Read command definition,Follow exact execution steps from .cursor/commands/
 5,Follow phase order,Phases build on each other
 6,Execute hooks,Pre/post phase automation from .cursor/hooks/
 7,Load relevant rules,Apply quality standards from .cursor/rules/
 8,Activate appropriate agents,Multi-agent collaboration
 9,Generate deliverables,Tangible outputs per phase
```

### At Phase Completion

```toon
always_completion[2]{num,rule,why}:
 10,Show deliverables,User sees what was accomplished
 11,Save workflow state,Enable resume if interrupted (.cursor/workflow-contexts/)
```

#### For Approval Phases (Phase 2 & 5b only)
```toon
approval_phases[2]{num,rule,why}:
 A1,Show approval gate,Human oversight for critical decisions
 A2,Wait for explicit approval,Architecture & implementation review
```

#### For Auto-Continue Phases (1, 3, 4, 5a, 5c, 6, 7, 8, 9)
```toon
auto_continue_phases[4]{num,rule,why}:
 AC1,Execute phase fully,Phase is NOT skipped
 AC2,Show deliverables,User sees what was done
 AC3,Continue automatically,No wait for approval
 AC4,Stop on blockers,Auto-stop if issues found
```

### After User Approval (Phase 2 & 5b)

```toon
always_after_approval[3]{num,rule,why}:
 13,IMMEDIATELY execute next phase,Auto-continue flow
 14,Show token usage,Monitor consumption
 15,Continue until next approval gate or blocker,Efficient execution
```

---

## NEVER Do

### Context & Loading

```toon
never_context[3]{num,rule,why}:
 1,Skip project context loading,Will use wrong conventions
 2,Ignore instruction hierarchy,Miss critical overrides
 3,Assume tech stack,Must detect/verify from .cursor/project-contexts/
```

### Approvals & Safety

```toon
never_approvals[3]{num,rule,why}:
 4,Ignore approval gates (Phase 2 & 5b),Critical decisions need user review
 5,Skip auto-continue phases entirely,Phases must execute and show deliverables
 6,Skip confirmation for destructive actions,Safety first
```

### External Systems

```toon
never_external[3]{num,rule,why}:
 7,Write to external systems without confirmation,Side effects need approval
 8,Commit credentials/tokens,Security risk
 9,Push to main/master without approval,Critical branch protection
```

### Code Quality

```toon
never_quality[4]{num,rule,why}:
 10,Implement without tests,TDD is mandatory
 11,Skip RED phase in TDD,Tests must fail first
 12,Ignore linter errors,Code quality standard
 13,Leave any/unknown types,TypeScript strictness
```

### Workflow Control

```toon
never_workflow[3]{num,rule,why}:
 14,Skip phases without justification,Phases exist for a reason
 15,Proceed if tests don't pass,Quality gate
 16,Continue if coverage below target,Coverage requirement
```

---

## Blocking Conditions

Execution MUST stop when:

```yaml
Blocking Events:
  - User rejection ("reject", "stop", "cancel")
  - Tests failing (in GREEN phase)
  - Coverage below target
  - Linter errors
  - Security vulnerabilities detected
  - Token limit approaching (150K warning)
  - External system errors
  - Missing required credentials
```

---

## Auto-Continue Conditions

After approval, continue automatically until:

```yaml
Continue Until:
  - Next approval gate reached
  - Blocking condition encountered
  - Workflow complete (Phase 9)
  - User interruption
  - Token limit reached
```

---

## Execution Flow Checklist

### Phase Start
```markdown
- [ ] Banner shown with correct agent
- [ ] Project context loaded from `.cursor/project-contexts/`
- [ ] Phase guide read from `.cursor/workflows/phases/`
- [ ] Relevant rules loaded from `.cursor/rules/`
- [ ] Pre-phase hook executed from `.cursor/hooks/`
```

### Phase Execution
```markdown
- [ ] Following phase steps exactly
- [ ] Generating required deliverables
- [ ] Applying quality rules
- [ ] Running tests (if applicable)
- [ ] Checking coverage (if applicable)
```

### Phase Complete
```markdown
- [ ] All deliverables generated
- [ ] Quality checks passed
- [ ] State saved to `.cursor/workflow-contexts/`
- [ ] Post-phase hook executed from `.cursor/hooks/`
- [ ] Approval gate shown
- [ ] Waiting for user response
```

---

## Exception Handling

### When Rules Conflict

**Priority:** .cursorrules > .cursor/rules/*.mdc > Cursor defaults

```yaml
Example:
  .cursor/rules/: "Test coverage must be 80%"
  .cursorrules: "Test coverage must be 90%"
  Result: Use 90% (.cursorrules wins)
```

### When User Requests Skip

```yaml
User: "Skip phase 3"
Action:
  1. Check if skip is allowed (see .cursor/rules/skills/auto-invoke/workflow-orchestrator/phase-skipping.md)
  2. If allowed: Document reason, proceed
  3. If not allowed: Explain why, suggest alternatives
```

### When Token Limit Approaching

```yaml
At 150K tokens (75% of 200K):
  1. Show warning
  2. Suggest handoff
  3. Save state automatically to `.cursor/workflow-contexts/`
  4. Provide resume instructions
```

---

## Enforcement Examples

### Correct Behavior

```markdown
✅ User: "Implement feature X"
   Agent:
   1. Shows banner
   2. Loads project context from `.cursor/project-contexts/`
   3. Starts Phase 1
   4. Shows approval gate
   5. Waits for approval
```

### Incorrect Behavior

```markdown
❌ User: "Implement feature X"
   Agent:
   1. Skips banner
   2. Assumes React project
   3. Starts coding immediately
   4. No approval gate
   5. Commits without review
```

---

## Quick Reference

### ALWAYS Checklist
```
□ Show agent banner
□ Load project context (.cursor/project-contexts/)
□ Follow phase order
□ Show deliverables at each phase completion
□ Wait for approval at Phase 2 & 5b only
□ Auto-continue through other phases
□ Save state (.cursor/workflow-contexts/)
□ Run tests
□ Check coverage
```

### NEVER Checklist
```
□ Skip context loading
□ Skip auto-continue phases (must execute & show deliverables)
□ Ignore approval gates at Phase 2 & 5b
□ Skip tests
□ Ignore linter
□ Commit secrets
□ Push to main without approval
□ Continue on blockers (tests fail, coverage low, security issues)
```

### Phase Behavior Summary
```
Approval Phases (2, 5b):     Execute → Show → WAIT → User approves → Continue
Auto-Continue Phases:        Execute → Show → Continue automatically
Auto-Stop (on blockers):     Execute → Issue found → STOP for fix
```

---

## File Path References

All file paths referenced in this rule:

- **Project Context:** `.cursor/project-contexts/[project]/`
- **Commands:** `.cursor/commands/`
- **Hooks:** `.cursor/hooks/`
- **Rules:** `.cursor/rules/`
- **Workflow State:** `.cursor/workflow-contexts/`
- **Workflow Guides:** `.cursor/workflows/phases/`
- **Logs:** `.cursor/logs/`

---

**Version:** 2.0.0
**Last Updated:** 2026-01-02
