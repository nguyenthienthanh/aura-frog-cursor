---
description: Safe dependency management with version pinning and security audits
globs: []
alwaysApply: true
---

# Dependency Management Rules

**Purpose:** Guidelines for managing dependencies safely and efficiently

## Dependency Categories

```toon
dep_categories[4]{type,location,example}:
 Production,dependencies,react/express
 Development,devDependencies,jest/eslint
 Peer,peerDependencies,Plugin requirements
 Optional,optionalDependencies,Platform-specific
```

## Version Pinning Strategy

```toon
version_pinning[4]{symbol,meaning,example,risk}:
 None,Exact,1.2.3,None
 ~,Patch,~1.2.3 → 1.2.x,Low
 ^,Minor,^1.2.3 → 1.x.x,Medium
 *,Any,*,High
```

### Recommendations
```json
{
  "dependencies": {
    "react": "^18.2.0",      // ^Minor for stable libs
    "some-lib": "~2.1.0",    // ~Patch for less stable
    "critical-dep": "1.2.3"  // Exact for critical deps
  }
}
```

## Lock Files

```toon
lock_files[3]{manager,lock_file,action}:
 npm,package-lock.json,Commit
 yarn,yarn.lock,Commit
 pnpm,pnpm-lock.yaml,Commit
```

**Always commit lock files** - ensures reproducible builds.

## Adding Dependencies

### Before Adding
```
1. Do we really need it?
2. Is it actively maintained?
3. What's the bundle size impact?
4. Are there security vulnerabilities?
5. What's the license?
```

### Evaluation Checklist

```toon
eval_checklist[5]{check,pass_criteria}:
 Stars,>1000 (for core deps)
 Last commit,<6 months
 Open issues,Reasonable ratio
 Bundle size,Justified for use case
 License,MIT/Apache/BSD
```

## Security

### Audit Regularly
```bash
# Check vulnerabilities
npm audit

# Fix automatically (safe)
npm audit fix

# Fix breaking changes (careful)
npm audit fix --force
```

## Bundle Size

### Monitor Size
```bash
# Analyze bundle
npx webpack-bundle-analyzer

# Check package size
npx bundlephobia lodash
```

### Optimization
```typescript
// ❌ Bad: Import entire library
import _ from 'lodash'

// ✅ Good: Import only what needed
import pick from 'lodash/pick'
```

## Dependency Checklist

### Adding
- [ ] Necessity confirmed
- [ ] Actively maintained
- [ ] Acceptable bundle size
- [ ] No security vulnerabilities
- [ ] Compatible license
- [ ] Correct category (dep vs devDep)

### Maintaining
- [ ] Lock file committed
- [ ] Security audits passing
- [ ] No outdated critical deps
- [ ] Unused deps removed
- [ ] Bundle size monitored

## Best Practices

### Do's
- Commit lock files
- Audit regularly
- Update incrementally
- Check bundle impact
- Use exact versions for critical deps

### Don'ts
- Use `*` versions
- Ignore security warnings
- Update all at once
- Skip testing after updates
- Add unnecessary deps

## References
- Project dependencies: `package.json`
- Performance rules: `performance.mdc`

---

**Version:** 1.11.0
**Last Updated:** 2026-02-13
