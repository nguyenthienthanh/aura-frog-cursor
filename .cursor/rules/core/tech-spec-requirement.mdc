---
description: Mandatory technical specification creation - TECH_SPEC_AI.md for AI consumption and full spec in Confluence single page format
globs: []
alwaysApply: true
---

# Tech Spec Requirement Rule

**Version:** 1.1.4
**Priority:** HIGH - Must follow for all feature implementations
**Type:** Rule (Mandatory)

---

## Core Principle

**For every feature implementation, you MUST create TWO technical specification documents:**

1. **TECH_SPEC_AI.md** - Simplified version for AI consumption (stored locally)
2. **Full Tech Spec** - Complete version in Confluence single page format (for humans)

**AI MUST read TECH_SPEC_AI.md, NOT the Confluence page.**

---

## Document Locations

```toon
doc_locations[2]{document,location,purpose}:
 TECH_SPEC_AI.md,.cursor/documents/specs/[feature-name]/TECH_SPEC_AI.md,AI reference during implementation
 Full Tech Spec,Confluence (single page),Human stakeholder reference
```

---

## TECH_SPEC_AI.md Format

This is the simplified version AI reads before and during implementation.

```markdown
# [Feature Name] - Tech Spec for AI

**JIRA:** [JIRA-XXXX]
**Created:** [YYYY-MM-DD]
**Version:** 1.0

---

## Overview

[2-3 sentences describing what this feature does]

---

## Requirements

### Functional
- FR-001: [Requirement]
- FR-002: [Requirement]

### Non-Functional
- NFR-001: Performance target
- NFR-002: Test coverage target

---

## Architecture

### Components
[List main components to create/modify]

### Data Flow
[Simple flow: Input → Processing → Output]

---

## Data Models

### Types (TypeScript)
```typescript
interface ExampleType {
  id: string;
  name: string;
}
```

### API Endpoints
| Method | Path | Description |
|--------|------|-------------|
| POST | /api/example | Create example |
| GET | /api/example/:id | Get example |

---

## Diagrams

### Sequence Diagram (Main Flow)
```mermaid
sequenceDiagram
    autonumber
    participant U as User
    participant C as Client
    participant A as API
    participant D as Database

    U->>C: [User action]
    C->>A: [API request]
    A->>D: [Database operation]
    D-->>A: [Result]
    A-->>C: [Response]
    C-->>U: [Feedback]
```

### ERD (if database changes)
```mermaid
erDiagram
    TABLE1 ||--o{ TABLE2 : relationship
    TABLE1 {
        uuid id PK
        string field
    }
```

> Include: Sequence (required), ERD (if DB), Architecture (if multi-service), State (if lifecycle)

---

## Implementation Notes

### Key Decisions
- [Decision 1 and why]
- [Decision 2 and why]

### Constraints
- [Constraint 1]
- [Constraint 2]

### Dependencies
- [Dependency 1]
- [Dependency 2]

---

## Test Strategy

### Unit Tests
- [ ] Test case 1
- [ ] Test case 2

### Integration Tests
- [ ] Test case 1

---

## Success Criteria

- [ ] All tests pass
- [ ] Coverage >= 85%
- [ ] Performance targets met
```

---

## Full Confluence Tech Spec Format

Complete technical specification in **single Confluence page** format.

### Required Sections (All in One Page)

```confluence
h1. [Feature Name] - Technical Specification

*JIRA:* [JIRA-XXXX] | *Status:* Draft | *Author:* [Name] | *Date:* [Date]

----

h2. 1. Overview & Scope

h3. 1.1 Purpose
[What this feature does and why]

h3. 1.2 Scope
*In Scope:*
* [Item 1]
* [Item 2]

*Out of Scope:*
* [Item 1]

h3. 1.3 Stakeholders
|| Role || Name ||
| Product | [PM] |
| Development | [Dev Team] |
| QA | [QA Team] |

----

h2. 2. Requirements

h3. 2.1 Functional Requirements
|| ID || Requirement || Priority ||
| FR-001 | [Description] | High |
| FR-002 | [Description] | Medium |

h3. 2.2 Non-Functional Requirements
|| ID || Requirement || Target ||
| NFR-001 | Performance | < 500ms |
| NFR-002 | Coverage | >= 85% |

----

h2. 3. Architecture

h3. 3.1 High-Level Design
{code:title=Component Diagram}
[Diagram or ASCII art]
{code}

h3. 3.2 Data Flow
{code}
User Action → Component → API → Database → Response
{code}

----

h2. 4. Data Models

h3. 4.1 TypeScript Interfaces
{code:typescript}
interface Example {
  id: string;
  name: string;
}
{code}

h3. 4.2 Database Schema
{code:sql}
CREATE TABLE example (
  id UUID PRIMARY KEY,
  name VARCHAR(255)
);
{code}

----

h2. 5. API Specification

h3. POST /api/example
*Description:* Create new example

*Request:*
{code:json}
{ "name": "string" }
{code}

*Response:*
{code:json}
{ "id": "uuid", "name": "string" }
{code}

----

h2. 6. Security & Performance

h3. 6.1 Security
* Authentication: JWT required
* Authorization: Role-based
* Input Validation: [Details]

h3. 6.2 Performance Targets
|| Metric || Target ||
| API Response | < 500ms |
| Page Load | < 2s |

----

h2. 7. Testing Strategy

h3. 7.1 Unit Tests
* [Test area 1]
* [Test area 2]

h3. 7.2 Integration Tests
* [Test scenario 1]

h3. 7.3 Coverage Target
*Minimum:* 85%

----

h2. 8. Risks & Dependencies

h3. 8.1 Risks
|| Risk || Impact || Mitigation ||
| [Risk] | High | [Plan] |

h3. 8.2 Dependencies
* [Dependency 1]
* [Dependency 2]

----

h2. 9. Approval

|| Role || Name || Status || Date ||
| Tech Lead | | Pending | |
| Product | | Pending | |

----

_Generated by Aura Frog v1.1.5_
```

---

## When to Create

### TECH_SPEC_AI.md Creation

```toon
ai_spec_creation[3]{phase,action}:
 Phase 2 (Design),MUST create TECH_SPEC_AI.md
 Before Phase 5,MUST verify TECH_SPEC_AI.md exists
 Before any implementation,AI MUST read TECH_SPEC_AI.md
```

### Full Confluence Spec Creation

```toon
confluence_spec_creation[2]{phase,action}:
 Phase 2 (Design),Create full tech spec
 Phase 8 (Document),Publish to Confluence
```

---

## AI Reading Rules

### MUST Read Before Implementation

```
Before Phase 5a (TDD RED):
1. Check if TECH_SPEC_AI.md exists
2. If exists → Read it
3. If not exists → STOP and create it first
4. Proceed with implementation using spec as reference
```

### DO NOT Read

- Full Confluence page (too verbose for AI context)
- External documentation links
- Marketing/user-facing docs

### DO Read

- TECH_SPEC_AI.md (concise, implementation-focused)
- Related test files
- Existing code in affected areas

---

## Validation Checklist

Before starting Phase 5:

- [ ] TECH_SPEC_AI.md exists at correct location
- [ ] TECH_SPEC_AI.md contains all required sections
- [ ] Full Confluence spec drafted (or scheduled for Phase 8)
- [ ] AI has read TECH_SPEC_AI.md

---

## File Naming Convention

```
.cursor/documents/specs/
├── user-authentication/
│   └── TECH_SPEC_AI.md
├── social-sharing/
│   └── TECH_SPEC_AI.md
└── payment-integration/
    └── TECH_SPEC_AI.md
```

**Naming rules:**
- Folder: kebab-case feature name
- File: Always `TECH_SPEC_AI.md` (uppercase)

---

## Integration with Workflow

```toon
workflow_integration[8]{phase,tech_spec_action}:
 1 (Understand),Gather requirements for spec
 2 (Design),CREATE TECH_SPEC_AI.md
 3 (UI),Reference spec for UI decisions
 4 (Test Plan),Use spec for test strategy
 5a-5c (TDD),AI reads TECH_SPEC_AI.md
 6 (Review),Validate against spec
 7 (Verify),Verify spec requirements met
 8 (Document),Publish full spec to Confluence
```

---

## Summary

```toon
summary[2]{document,for,location,when_created,when_read}:
 TECH_SPEC_AI.md,AI,Local .cursor/,Phase 2,Phase 5+
 Full Tech Spec,Humans,Confluence,Phase 2/8,By stakeholders
```

**Remember:**
- AI reads local TECH_SPEC_AI.md
- Humans read Confluence page
- Both are created in Phase 2
- Full spec published to Confluence in Phase 8

---

**Version:** 1.1.5
**Last Updated:** 2025-12-11
