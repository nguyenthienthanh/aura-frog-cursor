---
description: "Auto-invoke MCP tools AND trigger appropriate agents/workflows/skills. Zero-config integrations with intelligent routing."
globs: []
alwaysApply: true
---

# MCP Integrations Auto-Invoke

**Type:** Auto-Invoke (Always Active)
**Trigger:** Pattern detection â†’ MCP Tool â†’ Agent/Workflow/Skill

## MCP Server Overview

| MCP | Purpose | Default |
|-----|---------|---------|
| context7 | Library docs lookup | Enabled |
| playwright | E2E/browser testing | Enabled |
| filesystem | File operations | Enabled |
| memory | Persistent context | Enabled |
| github | Git/GitHub operations | Disabled* |
| vitest | Unit testing | Disabled* |
| atlassian | JIRA/Confluence | Disabled* |
| figma | Design tokens | Disabled* |
| slack | Team notifications | Disabled* |

*Requires credentials in `.envrc`

---

## Core MCP Tools (Always Available)

### Filesystem
**Use for:** File read/write, directory operations, search

**Tools:**
- `read_file` - Read file contents
- `write_file` - Write/create files
- `list_directory` - List directory contents
- `search_files` - Search file contents
- `get_file_info` - Get file metadata

### Memory
**Use for:** Persistent context across sessions

**Tools:**
- `store` - Save key-value data
- `retrieve` - Get stored data
- `list_keys` - List stored keys

### Playwright (E2E Testing)
**Trigger:** "e2e test", "playwright", "browser test"

**Chain:**
1. **MCP:** playwright tools
2. **Agent:** `qa-automation`
3. **Skill:** `test-writer`

---

## Credential-Based MCP Tools

### GitHub
**Trigger:** Git operations, PR creation, issue management
**Requires:** `GITHUB_TOKEN` in `.envrc`

**Tools:**
- `create_pull_request` - Create PR
- `list_issues` - List issues
- `create_issue` - Create issue
- `search_code` - Search GitHub code

### Vitest (Unit Testing)
**Trigger:** "unit test", "vitest", "coverage"

**Chain:**
1. **MCP:** vitest tools (run_tests, get_coverage)
2. **Agent:** `qa-automation`
3. **Skill:** `test-writer`

### Figma
**Trigger:** `figma.com/file/` URL detected

**Chain:**
1. **MCP:** figma tools
2. **Agent:** `ui-designer`
3. **Skill:** framework-specific expert

### Atlassian (JIRA/Confluence)
**Trigger:** `[A-Z]{2,10}-\d+` ticket pattern

**Chain:**
1. **MCP:** atlassian tools
2. **Skill:** `workflow-orchestrator`
3. **Agent:** auto-detected by labels

### Slack
**Trigger:** `#channel`, "notify team"

**Tools:**
- `slack_list_channels`
- `slack_post_message`
- `slack_get_channel_history`

---

## Agent Selection Matrix

| MCP Tool | Primary Agent | Skills Loaded |
|----------|--------------|---------------|
| playwright | qa-automation | test-writer, testing-expert |
| vitest | qa-automation | test-writer, testing-expert |
| figma | ui-designer | react/vue/angular-expert |
| atlassian | (auto-detect) | workflow-orchestrator |
| github | (current) | git-workflow |
| filesystem | (current) | - |
| memory | (current) | session-continuation |

---

## Workflow Auto-Population

| MCP Source | Workflow Phase | Auto-Fill |
|------------|----------------|-----------|
| JIRA ticket | Phase 1 | Requirements, acceptance criteria |
| Figma design | Phase 3 | Design tokens, components |
| Confluence doc | Phase 2 | Technical specs |
| Playwright snapshot | Phase 5c | Element selectors |

---

## Chaining Examples

### Full Feature (JIRA + Figma)
```
User: "Implement PROJ-456 using figma.com/file/XYZ"

Chain:
1. atlassian â†’ fetch JIRA requirements
2. figma â†’ fetch design tokens
3. workflow-orchestrator â†’ start workflow
4. Phase 1 + Phase 3 auto-populated
```

### TDD Flow
```
User: "Add auth feature with TDD"

Chain:
1. qa-automation agent
2. vitest â†’ unit tests
3. playwright â†’ E2E tests
4. Workflow: 5a â†’ 5b â†’ 5c
```

### GitHub PR
```
User: "Create PR for this feature"

Chain:
1. github â†’ create_pull_request
2. filesystem â†’ read changed files
3. Generate PR description
```

---

## Data Persistence (MANDATORY)

**All fetched data MUST be saved to logs in TOON format.**

### JIRA Ticket Data

**Location:** `.cursor/logs/jira/`

**When JIRA ticket is fetched:**
1. Fetch ticket via `atlassian` MCP
2. **IMMEDIATELY** save to `.cursor/logs/jira/{TICKET_ID}.toon`
3. Create readable summary at `.cursor/logs/jira/{TICKET_ID}-readable.txt`

**TOON Format:**
```toon
jira_ticket{key,summary,status,type,priority,assignee,reporter,created,updated}:
 PROJ-123,Implement user auth,In Progress,Story,High,john@example.com,jane@example.com,2025-12-20,2025-12-22

description: |
 As a user, I want to login so that I can access my account.

 Acceptance Criteria:
 - User can login with email/password
 - User sees error on invalid credentials
 - Session persists for 24 hours

labels[3]: auth,mvp,backend

subtasks[2]{key,summary,status}:
 PROJ-124,Create login API,Done
 PROJ-125,Add session management,In Progress

comments[2]{author,date,body}:
 john@example.com,2025-12-21,Started implementation
 jane@example.com,2025-12-22,Please add rate limiting
```

### Figma Design Data

**Location:** `.cursor/logs/figma/`

**When Figma file is fetched:**
1. Fetch design via `figma` MCP
2. **IMMEDIATELY** save to `.cursor/logs/figma/{FILE_ID}.toon`
3. Create readable summary at `.cursor/logs/figma/{FILE_ID}-readable.txt`

**TOON Format:**
```toon
figma_file{id,name,lastModified,version}:
 ABC123,Mobile App Design,2025-12-22T10:00:00Z,1234567

colors[5]{name,hex,rgba}:
 primary,#3B82F6,rgb(59 130 246)
 secondary,#10B981,rgb(16 185 129)
 background,#FFFFFF,rgb(255 255 255)
 text,#1F2937,rgb(31 41 55)
 error,#EF4444,rgb(239 68 68)

typography[3]{name,family,size,weight}:
 heading,Inter,24px,700
 body,Inter,16px,400
 caption,Inter,12px,400

components[4]{id,name,type}:
 btn-primary,Primary Button,COMPONENT
 btn-secondary,Secondary Button,COMPONENT
 input-text,Text Input,COMPONENT
 card,Card Container,COMPONENT
```

### Cache-First Behavior

```
1. CHECK: Does `.cursor/logs/{service}/{ID}.toon` exist?
2. IF YES: Read from cache, show "ðŸ“‹ Using cached data from {date}"
3. IF NO or user says "fetch/refresh": Fetch via MCP â†’ Save to logs
```

**Refresh Keywords:** `fetch`, `refresh`, `update`, `get latest`

---

## Quick Enable

```bash
# 1. Add credentials to .envrc
export GITHUB_TOKEN="ghp_xxx"
export ATLASSIAN_API_TOKEN="xxx"
export FIGMA_API_KEY="figd_xxx"

# 2. Edit .cursor/mcp.json
# Set "disabled": false for services you want

# 3. Restart Cursor
```

---

**Version:** 1.2.0
**Last Updated:** 2025-12-22
