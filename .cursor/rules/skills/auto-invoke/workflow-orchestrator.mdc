---
description: "9-phase TDD workflow for complex features. Auto-detects 'implement', 'build', 'create feature', 'workflow:start'. Manages phases: Understand â†’ Design â†’ UI â†’ Tests â†’ TDD RED/GREEN/REFACTOR â†’ Review â†’ Verify â†’ Document â†’ Share."
globs: []
alwaysApply: false
---

# Workflow Orchestrator

**Type:** Auto-Invoke
**Trigger:** Complex feature implementation requests

## Purpose

Executes a structured 9-phase workflow for complex feature implementations, ensuring quality through Test-Driven Development (TDD), cross-review, and approval gates.

## Activation Logic

Cursor AI should activate this skill when:
- User mentions: `implement`, `build`, `create feature`, `new feature`
- Explicit workflow command: `workflow:start`
- Task complexity > 2 hours estimated
- Multi-file changes required
- Tasks requiring TDD workflow

**DO NOT** activate for:
- Bug fixes â†’ use `bugfix-quick` skill
- Quick refactors â†’ direct edit
- Config changes â†’ direct edit
- Simple questions â†’ just answer

## Pre-Execution Checklist

1. **agent-detector** â†’ Select lead agent (MANDATORY)
2. **project-context-loader** â†’ Load conventions (MANDATORY)
3. **Show agent banner** at start of response
4. **Verify task complexity** - if simple, suggest lighter approach
5. **Create TECH_SPEC_AI.md** in Phase 2 (MANDATORY - see `tech-spec-requirement.mdc`)
6. **Create Mermaid diagrams** in Phase 2 (see `mermaid-diagrams.mdc`)

## Phase Banner (MANDATORY)

**Before EACH phase, display the agent banner:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: [agent-name]                                     â”‚
â”‚  ğŸ“ Phase [N]: [Phase Name]                                 â”‚
â”‚  ğŸ“¦ Delivering: [deliverable]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Banner Examples

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: pm-operations-orchestrator                       â”‚
â”‚  ğŸ“ Phase 1: Understand ğŸ¯                                  â”‚
â”‚  ğŸ“¦ Delivering: Requirements document                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: web-reactjs                                      â”‚
â”‚  ğŸ“ Phase 2: Design ğŸ—ï¸                                      â”‚
â”‚  ğŸ“¦ Delivering: Technical design + TECH_SPEC_AI.md          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: security-expert                                  â”‚
â”‚  ğŸ“ Phase 6: Review ğŸ‘€                                      â”‚
â”‚  ğŸ“¦ Delivering: Quality review report                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9-Phase Workflow

```toon
workflow_phases[11]{phase,name,lead_agent,deliverable,gate}:
 1,Understand ğŸ¯,pm-operations-orchestrator,Requirements document,âš¡ Auto
 2,Design ğŸ—ï¸,Dev agent,Technical design + TECH_SPEC_AI.md + Mermaid diagrams,âœ‹ Approval
 3,UI Breakdown ğŸ¨,ui-designer,Component breakdown,âš¡ Auto
 4,Plan Tests ğŸ§ª,qa-automation,Test strategy,âš¡ Auto
 5a,Write Tests ğŸ”´,qa-automation + Dev,Failing tests (TDD RED),âš¡ Auto
 5b,Build ğŸŸ¢,Dev agent,Implementation (TDD GREEN),âœ‹ Approval
 5c,Polish â™»ï¸,Dev agent,Refactored code (TDD REFACTOR),âš¡ Auto
 6,Review ğŸ‘€,security-expert,Quality review report,âš¡ Auto*
 7,Verify âœ…,qa-automation,All tests pass/coverage â‰¥80%,âš¡ Auto
 8,Document ğŸ“š,pm-operations-orchestrator,Documentation,âš¡ Auto
 9,Share ğŸ””,slack-operations,Team notification,âš¡ Auto
```

**Gate Legend:**
- âœ‹ Approval = Must wait for user approval before continuing
- âš¡ Auto = Auto-continue after showing deliverables
- âš¡ Auto* = Auto-continue unless critical issues found

## Phase Transition Rules

### Valid Transitions

```
Phase 1 (Understand) â†’ Phase 2 (Design)
  Mode: âš¡ AUTO-CONTINUE
  Shows: Requirements summary, then continues

Phase 2 (Design) â†’ Phase 3 (UI)
  Mode: âœ‹ APPROVAL REQUIRED
  Blocker: No technical design approved

Phase 3 (UI) â†’ Phase 4 (Plan Tests)
  Mode: âš¡ AUTO-CONTINUE
  Skip if: No UI component in task

Phase 4 (Plan Tests) â†’ Phase 5a (Write Tests)
  Mode: âš¡ AUTO-CONTINUE
  Pre-check: AI MUST read TECH_SPEC_AI.md before proceeding

Phase 5a (RED) â†’ Phase 5b (GREEN)
  Mode: âš¡ AUTO-CONTINUE (if tests fail as expected)
  Blocker: Tests pass (they should fail!) â†’ STOP

Phase 5b (GREEN) â†’ Phase 5c (REFACTOR)
  Mode: âœ‹ APPROVAL REQUIRED
  Blocker: Tests still failing

Phase 5c (REFACTOR) â†’ Phase 6 (Review)
  Mode: âš¡ AUTO-CONTINUE (if tests still pass)
  Blocker: Tests broken by refactor â†’ STOP

Phase 6 (Review) â†’ Phase 7 (Verify)
  Mode: âš¡ AUTO-CONTINUE (unless critical issues)
  Blocker: Critical security issues â†’ STOP for approval

Phase 7 (Verify) â†’ Phase 8 (Document)
  Mode: âš¡ AUTO-CONTINUE (if tests pass)
  Blocker: Tests fail or coverage <80% â†’ STOP

Phase 8 (Document) â†’ Phase 9 (Share)
  Mode: âš¡ AUTO-CONTINUE
  Auto-executes Phase 9
```

### Summary: Only 2 Approval Gates

| Gate | Phase | Why |
|------|-------|-----|
| 1st | Phase 2 (Design) | Architecture decisions are hard to change later |
| 2nd | Phase 5b (GREEN) | Main implementation - review before refactor |

All other phases auto-continue unless a blocker is hit.

### Invalid Transitions (BLOCKED)

- âŒ Skip from Phase 1 to Phase 5 (no design)
- âŒ Phase 5b without 5a (no TDD)
- âŒ Phase 7 with failing tests
- âŒ Any phase skip without explicit user request

## Approval Gates (Only 2)

Approval is only required at **Phase 2 (Design)** and **Phase 5b (Implementation)**.

### Gate Format

```markdown
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ—ï¸ Phase [N]: [Name] - Approval Needed (Gate [X] of 2)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## [Friendly Summary] âœ¨

[Deliverables list]

---

â­ï¸ **After approval (AUTO-CONTINUE):**
â†’ Phases [N+1] to [X] will auto-continue
â†’ Next approval gate: Phase [Y]

---

**Options:**
- `approve` / `yes` â†’ Continue (auto-runs until next gate)
- `reject: <reason>` â†’ Re-do this phase
- `modify: <changes>` â†’ Adjust deliverables
- `stop` â†’ Cancel workflow

âš¡ After approval, I'll AUTO-CONTINUE through multiple phases!
```

### Valid Responses

```toon
valid_responses[4]{response,action}:
 approve/yes,Continue to next phase immediately
 reject: <reason>,Restart current phase with feedback
 modify: <changes>,Adjust deliverables then re-show gate
 stop/cancel,End workflow and save state
```

## AUTO-CONTINUE Behavior

**Streamlined workflow with only 2 approval gates:**

### Flow Overview
```
START â†’ Phase 1 (auto) â†’ Phase 2 âœ‹ APPROVAL
      â†’ Phase 3-5a (auto) â†’ Phase 5b âœ‹ APPROVAL
      â†’ Phase 5c-9 (auto) â†’ DONE
```

### Example Flow
```
User: "workflow:start Add JWT authentication"

â†’ Phase 1: Understand (shows summary, auto-continues)
â†’ Phase 2: Design
  âœ‹ APPROVAL GATE (1 of 2) - waits for user

User: "approve"

â†’ Phase 3: UI Breakdown (auto-continues)
â†’ Phase 4: Test Plan (auto-continues)
â†’ Phase 5a: TDD RED - write failing tests (auto-continues if tests fail)
â†’ Phase 5b: TDD GREEN - implementation
  âœ‹ APPROVAL GATE (2 of 2) - waits for user

User: "approve"

â†’ Phase 5c: Refactor (auto-continues if tests pass)
â†’ Phase 6: Review (auto-continues unless critical issues)
â†’ Phase 7: Verify (auto-continues if tests pass)
â†’ Phase 8: Document (auto-continues)
â†’ Phase 9: Share (auto-executes)
â†’ DONE âœ…
```

**Auto-Stop Triggers:**
- Tests fail when they shouldn't (or pass when they should fail)
- Critical security issues in review
- Coverage below 80%
- Token limit reached

## Critical Rules

### TDD (NON-NEGOTIABLE)

```
Phase 5a (RED):
  âœ… Write tests FIRST
  âœ… Run tests â†’ MUST FAIL
  âŒ If tests pass â†’ STOP, tests aren't testing new code

Phase 5b (GREEN):
  âœ… Write minimal code to pass tests
  âœ… Run tests â†’ MUST PASS
  âŒ If tests fail â†’ Fix code, not tests

Phase 5c (REFACTOR):
  âœ… Clean up code
  âœ… Run tests â†’ MUST STILL PASS
  âŒ If tests fail â†’ Revert refactor
```

### KISS Principle

- âœ… Simple over complex
- âœ… Standard patterns over custom
- âœ… Solve today's problem, not tomorrow's
- âŒ No premature abstraction
- âŒ No over-engineering
- âŒ No excessive configuration

### Cross-Review

```toon
cross_review[4]{phase,creator,reviewers}:
 1 (Understand),PM,Dev + QA + UI
 2 (Design),Dev,Secondary Dev + QA
 4 (Plan Tests),QA,Dev
 6 (Review),Security,All
```

## Phase Skip Rules

### Automatic Skips

- **Phase 3 (UI):** Skip if task has no UI components
- **Phase 9 (Share):** Skip if no Slack integration configured

### User-Requested Skips

User can request skip with reason:
```
User: "skip phase 3, this is backend only"
â†’ Log skip reason
â†’ Proceed to Phase 4
```

## State Management

### Session Context
```toon
# Updated live in .cursor/aura-frog/session-context.toon
state{phase,feature,started}:
 5b,User Auth,2025-12-16T10:00

decisions[2]{id,choice,reason}:
 1,JWT tokens,Stateless + scalable
 2,bcrypt,Industry standard
```

### Save State
```
workflow:handoff
â†’ Saves to .cursor/aura-frog/session-context.toon
â†’ Contains: current phase, decisions, patterns
```

### Resume State
```
workflow:resume
â†’ Loads from .cursor/aura-frog/session-context.toon
â†’ Continues from last phase
â†’ Re-shows approval gate if pending
```

### Workflow Status
```
workflow:status
â†’ Reads .cursor/aura-frog/session-context.toon
â†’ Shows: current phase, completed phases, pending tasks
```

## Example Workflow Execution

```
User: "workflow:start Add user authentication with JWT"

â”â”â” AUTO-CONTINUE BLOCK 1 â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: pm-operations-orchestrator                       â”‚
â”‚  ğŸ“ Phase 1: Understand ğŸ¯ [AUTO]                           â”‚
â”‚  ğŸ“¦ Delivering: Requirements document                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€ Analyze requirements
â”œâ”€â”€ Define success criteria
â””â”€â”€ Shows summary, continues automatically...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: backend-nodejs                                   â”‚
â”‚  ğŸ“ Phase 2: Design ğŸ—ï¸                                      â”‚
â”‚  ğŸ“¦ Delivering: Technical design + TECH_SPEC_AI.md          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€ Design JWT architecture
â”œâ”€â”€ Create TECH_SPEC_AI.md + Mermaid diagrams
â””â”€â”€ âœ‹ APPROVAL GATE (1 of 2)

User: "approve"

â”â”â” AUTO-CONTINUE BLOCK 2 â”â”â”

Phase 3: UI Breakdown ğŸ¨ [AUTO]
Phase 4: Test Plan ğŸ§ª [AUTO]
Phase 5a: TDD RED ğŸ”´ [AUTO] (if tests fail as expected)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent: backend-nodejs                                   â”‚
â”‚  ğŸ“ Phase 5b: Build ğŸŸ¢                                      â”‚
â”‚  ğŸ“¦ Delivering: Implementation (TDD GREEN)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€ Implement code to pass tests
â””â”€â”€ âœ‹ APPROVAL GATE (2 of 2)

User: "approve"

â”â”â” AUTO-CONTINUE BLOCK 3 â”â”â”

Phase 5c: Polish â™»ï¸ [AUTO]
Phase 6: Review ğŸ‘€ [AUTO] (unless critical issues)
Phase 7: Verify âœ… [AUTO] (if tests pass)
Phase 8: Document ğŸ“š [AUTO]
Phase 9: Share ğŸ”” [AUTO]

â†’ DONE âœ…

TOTAL APPROVALS NEEDED: 2
```

## Token Awareness

- At 75% (150K tokens): Warn user
- At 85% (170K tokens): Suggest `workflow:handoff`
- At 90% (180K tokens): Force handoff

## Integration

Works seamlessly with:
- `agent-detector` - Gets correct lead agent for each phase
- `project-context-loader` - Loads project conventions before design/implementation
- `test-writer` - Used in Phase 5a for TDD RED
- `code-reviewer` - Used in Phase 6 for quality review
- `jira-integration` - Auto-updates ticket status if configured

## References

- Session context: `.cursor/aura-frog/session-context.toon`
- Consistency rule: `codebase-consistency.mdc`
- Project context: `.cursor/project-contexts/`
- Rules: `tdd-workflow`, `kiss-principle`, `code-quality`, `tech-spec-requirement`
- Tech spec template: `.cursor/rules/templates/tech-spec.mdc`
- Mermaid diagrams: `.cursor/rules/skills/reference/mermaid-diagrams.mdc`

---

**Version:** 1.10.0
**Last Updated:** 2026-01-15
