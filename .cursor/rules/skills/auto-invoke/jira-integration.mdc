---
description: "Auto-fetch JIRA tickets when ID detected (PROJ-1234 pattern). Extracts requirements, acceptance criteria, updates status. Requires JIRA credentials in .envrc."
globs: []
alwaysApply: false
---

# JIRA Integration

**Type:** Auto-Invoke
**Trigger:** JIRA ticket ID or URL detected

## Purpose

Automatically fetches JIRA ticket details when a ticket ID is mentioned, extracting requirements and acceptance criteria to inform development. Optionally updates ticket status throughout workflow phases.

## Activation Logic

Cursor AI should activate this skill when:
- Ticket ID mentioned: `PROJ-1234`, `IGNT-567` (uppercase letters 2-10 chars + dash + numbers)
- JIRA URL shared: `https://company.atlassian.net/browse/PROJ-1234`
- Starting workflow with ticket reference
- Updating ticket status requested

## Integration Process

### 1. Detect Ticket ID

**Pattern:** `[A-Z]{2,10}-\d+`

**Examples:**
- `PROJ-1234`
- `IGNT-567`
- `EX-8277`
- `MARKETPLACE-42`

```javascript
// Detection regex
const match = message.match(/([A-Z]{2,10})-(\d+)/);
const ticketId = match[0]; // "PROJ-1234"
```

### 2. Check for Existing Log Data (PRIORITY)

**‚ö†Ô∏è IMPORTANT: Always check for cached data first before fetching!**

**Log file locations (check in order):**
```
.cursor/logs/jira/{TICKET_ID}-readable.txt  ‚Üê Human-readable format
.cursor/logs/jira/{TICKET_ID}.json          ‚Üê Raw JSON data
logs/jira/{TICKET_ID}-readable.txt          ‚Üê Alternative location
logs/jira/{TICKET_ID}.json                  ‚Üê Alternative location
```

**Decision logic:**
```
IF log file exists AND user did NOT request "fetch", "refresh", "update":
  ‚Üí READ from log file using Read tool
  ‚Üí Show cached data with note: "üìã Using cached data from {date}"

IF log file does NOT exist OR user requests fresh data:
  ‚Üí FETCH using bash script
```

**Read cached data:**
```bash
# Prefer readable format
Read .cursor/logs/jira/PROJ-1234-readable.txt

# Or parse JSON if needed
Read .cursor/logs/jira/PROJ-1234.json
```

### 3. Fetch Fresh Data (Only When Needed)

**Fetch when:**
- No cached log exists
- User says: "fetch", "refresh", "update", "get latest"
- User explicitly requests fresh data

```bash
# Run JIRA fetch script
bash .cursor/scripts/jira-fetch.sh PROJ-1234

# Output saved to:
#   .cursor/logs/jira/PROJ-1234-readable.txt  ‚Üê Formatted data
#   .cursor/logs/jira/PROJ-1234.json          ‚Üê Raw JSON
#   .cursor/logs/jira/jira-fetch-{timestamp}.log ‚Üê Execution log
```

**Script checks:**
1. JIRA credentials configured in `.envrc`
2. Network connectivity
3. Ticket exists and accessible

**Output format:**
```json
{
  "key": "PROJ-1234",
  "summary": "Add user authentication",
  "description": "Implement JWT-based authentication...",
  "status": "To Do",
  "assignee": "john.doe",
  "priority": "High",
  "labels": ["backend", "security"],
  "acceptanceCriteria": [
    "User can login with email/password",
    "JWT token generated on successful login",
    "Token expires after 24 hours"
  ],
  "comments": [],
  "created": "2025-01-15T10:00:00Z",
  "updated": "2025-01-20T14:30:00Z"
}
```

### 4. Use in Workflow

**Map JIRA fields to workflow:**

| JIRA Field | Workflow Usage |
|------------|----------------|
| Summary | Task title for Phase 1 |
| Description | Requirements for Phase 1 |
| Acceptance Criteria | Success criteria for Phase 1 |
| Labels | Hints for agent detection (backend, frontend, etc.) |
| Priority | Urgency level |
| Status | Current state (update throughout workflow) |

**Example usage in Phase 1:**
```markdown
## Phase 1: Understand

### Requirements (from JIRA PROJ-1234)

**Summary:** Add user authentication

**Description:**
Implement JWT-based authentication for the mobile app.
Users should be able to login with email/password.

**Acceptance Criteria:**
- ‚úÖ User can login with email/password
- ‚úÖ JWT token generated on successful login
- ‚úÖ Token expires after 24 hours
- ‚úÖ Refresh token mechanism implemented

**Priority:** High
**Labels:** backend, security, authentication
```

### 5. Update Status (Optional)

**Automatic status updates:**

| Workflow Phase | JIRA Status Transition |
|----------------|----------------------|
| Phase 1 start | To Do ‚Üí In Progress |
| Phase 5b done | In Progress ‚Üí In Review |
| Phase 7 done | In Review ‚Üí Testing |
| Phase 9 done | Testing ‚Üí Done |

```bash
# Update status
bash ~/.cursor/plugins/marketplaces/aurafrog/aura-frog/scripts/jira-update.sh PROJ-1234 status "In Progress"

# Add comment
bash ~/.cursor/plugins/marketplaces/aurafrog/aura-frog/scripts/jira-update.sh PROJ-1234 comment "Implementation started - Phase 5b"

# Add work log
bash ~/.cursor/plugins/marketplaces/aurafrog/aura-frog/scripts/jira-update.sh PROJ-1234 worklog "2h" "Implemented authentication endpoints"
```

## Setup

### Required Environment Variables

**In `.envrc` (at project root):**
```bash
export JIRA_URL="https://company.atlassian.net"
export JIRA_EMAIL="your-email@company.com"
export JIRA_API_TOKEN="your-api-token-here"
```

### Generate JIRA API Token

1. Go to: https://id.atlassian.com/manage-profile/security/api-tokens
2. Click "Create API token"
3. Copy token
4. Add to `.envrc`
5. Run: `direnv allow` (if using direnv)

### Verify Setup

```bash
# Test JIRA connection
bash ~/.cursor/plugins/marketplaces/aurafrog/aura-frog/scripts/jira-test.sh

# Expected output:
# ‚úÖ JIRA connection successful
# ‚úÖ Authentication valid
# ‚úÖ Can access tickets
```

## If Not Configured

When JIRA ticket ID detected but credentials not configured:

```markdown
‚ö†Ô∏è **JIRA Integration Not Configured**

Detected ticket: PROJ-1234

**Options:**
1. **Configure JIRA** (recommended)
   - Add credentials to .envrc
   - Run: `bash scripts/jira-setup.sh`

2. **Provide ticket details manually**
   - Paste requirements
   - Continue without JIRA integration

3. **Skip for now**
   - Workflow continues without ticket context

Which option? [1/2/3]
```

## Status Transitions

### Standard Workflow

```
To Do ‚Üí In Progress ‚Üí In Review ‚Üí Testing ‚Üí Done
```

### Custom Statuses

Projects may have custom status names:
```
Backlog ‚Üí In Development ‚Üí Code Review ‚Üí QA ‚Üí Deployed
```

**Configuration in project-config.yaml:**
```yaml
jira:
  status_mapping:
    phase_1: "In Development"
    phase_5b: "Code Review"
    phase_7: "QA"
    phase_9: "Deployed"
```

## Notification on Status Change

```markdown
‚úÖ JIRA ticket updated: PROJ-1234

**Status:** To Do ‚Üí In Progress
**Comment:** "Started implementation - Phase 1 complete"
**Link:** https://company.atlassian.net/browse/PROJ-1234
```

## Error Handling

### Ticket Not Found
```markdown
‚ùå JIRA ticket not found: PROJ-1234

**Possible reasons:**
- Ticket doesn't exist
- No permission to access ticket
- Ticket from different JIRA instance

Continue without ticket context? [yes/no]
```

### Authentication Failed
```markdown
‚ùå JIRA authentication failed

**Check:**
- JIRA_EMAIL is correct
- JIRA_API_TOKEN is valid
- JIRA_URL is correct

Update credentials in .envrc and retry? [yes/no]
```

### Network Error
```markdown
‚ö†Ô∏è Could not connect to JIRA

**Continuing without JIRA integration**

You can manually provide ticket details or retry later.
```

## Integration

Works seamlessly with:
- `workflow-orchestrator` - Auto-loads ticket details in Phase 1
- `agent-detector` - Uses ticket labels for agent selection hints
- `project-context-loader` - Loads JIRA config from project context
- Slack integration - Notifies team of ticket status changes

## Benefits

1. **Automatic Context** - No need to copy-paste requirements
2. **Traceability** - Link code changes to tickets
3. **Status Sync** - Keep JIRA updated automatically
4. **Collaboration** - Team sees real-time progress
5. **History** - Work logs and comments captured

## Optional Features

### Auto-assign Ticket
```bash
# Assign to current user when work starts
bash scripts/jira-update.sh PROJ-1234 assign me
```

### Link PR to Ticket
```bash
# Add PR link to ticket
bash scripts/jira-update.sh PROJ-1234 link "https://github.com/org/repo/pull/123"
```

### Track Time
```bash
# Log time spent
bash scripts/jira-update.sh PROJ-1234 worklog "3h 30m" "Implemented authentication"
```

## Privacy & Security

**Important:**
- JIRA tokens have full access to your JIRA account
- Never commit `.envrc` to version control
- Add to `.gitignore`:
  ```
  .envrc
  .cursor/logs/jira/*.json
  ```
- Tokens can be revoked at: https://id.atlassian.com/manage-profile/security/api-tokens

## References

- JIRA REST API: https://developer.atlassian.com/cloud/jira/platform/rest/v3/
- Setup guide: Project documentation
- Integration scripts: `~/.cursor/plugins/marketplaces/aurafrog/aura-frog/scripts/`

## Note

**JIRA integration is optional.** The workflow works perfectly fine without it. It's a convenience feature for teams already using JIRA for project management.

---

**Version:** 1.1.7
**Last Updated:** 2025-12-17
