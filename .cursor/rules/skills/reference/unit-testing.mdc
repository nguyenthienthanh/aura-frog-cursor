---
description: "Unit testing patterns for Jest, React Testing Library, Vitest, PHPUnit"
globs:
  - "**/*.test.ts"
  - "**/*.test.tsx"
  - "**/*.spec.ts"
  - "**/__tests__/**"
alwaysApply: false
---

# Unit Testing Patterns

## Jest + React Testing Library

### Component Testing
```typescript
import { render, screen, fireEvent } from '@testing-library/react'

describe('UserCard', () => {
  const mockUser = { id: '1', name: 'John Doe', email: 'john@example.com' }

  it('renders user information', () => {
    render(<UserCard user={mockUser} />)
    expect(screen.getByText('John Doe')).toBeInTheDocument()
  })

  it('calls onEdit when clicked', () => {
    const handleEdit = jest.fn()
    render(<UserCard user={mockUser} onEdit={handleEdit} />)
    fireEvent.click(screen.getByRole('button', { name: /edit/i }))
    expect(handleEdit).toHaveBeenCalledWith(mockUser.id)
  })
})
```

### Hook Testing
```typescript
import { renderHook, act } from '@testing-library/react'

describe('useCounter', () => {
  it('increments counter', () => {
    const { result } = renderHook(() => useCounter())
    act(() => result.current.increment())
    expect(result.current.count).toBe(1)
  })
})
```

### Async Testing with MSW
```typescript
import { server } from '../mocks/server'
import { rest } from 'msw'

describe('userService', () => {
  it('fetches users', async () => {
    const users = await userService.getAll()
    expect(users).toHaveLength(3)
  })

  it('handles errors', async () => {
    server.use(
      rest.get('/api/users', (req, res, ctx) =>
        res(ctx.status(500), ctx.json({ error: 'Server error' }))
      )
    )
    await expect(userService.getAll()).rejects.toThrow()
  })
})
```

## Mocking Strategies

```typescript
// Mock functions
const mockFetch = jest.fn()
mockFetch.mockResolvedValue({ json: async () => ({ data: 'test' }) })

// Mock modules
jest.mock('../api')
import { fetchUser } from '../api'
fetchUser.mockResolvedValue({ id: 1, name: 'John' })

// Spy
const spy = jest.spyOn(console, 'error').mockImplementation()
```

## Coverage Configuration

```javascript
// jest.config.js
{
  "coverageThresholds": {
    "global": {
      "branches": 80,
      "functions": 80,
      "lines": 80,
      "statements": 80
    }
  }
}
```

## Best Practices

### Do's ✅
- Follow AAA pattern (Arrange, Act, Assert)
- Test behavior, not implementation
- Use descriptive test names
- Keep tests independent
- Mock external dependencies
- Aim for 80%+ coverage

### Don'ts ❌
- Test implementation details
- Share state between tests
- Write flaky tests
- Mock everything
- Test third-party libraries

## Test Organization

```
tests/
├── unit/
│   ├── components/
│   ├── hooks/
│   └── utils/
├── integration/
└── e2e/
```

---

**Used by:** qa-automation agent
